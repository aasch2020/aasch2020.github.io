{% comment %}
Reusable PDF modal include.
Usage: {% include pdf-modal.html file="/assets/pdfs/KVM.pdf" label="View PDF" %}
{% endcomment %}
{% assign pdf_file = include.file %}
{% assign pdf_label = include.label | default: "View PDF" %}
{% assign pdf_id = pdf_file | replace: "/", "-" | replace: ".", "-" %}

<p>
  <button id="view-pdf-{{ pdf_id }}" class="btn">{{ pdf_label }}</button>
</p>

<div id="pdf-modal-{{ pdf_id }}" class="pdf-modal" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="pdf-modal-content">
    <button class="pdf-modal-close btn" aria-label="Close">Close</button>
    <object data="{{ pdf_file }}#view=FitH" type="application/pdf" width="100%" height="100%">
      <p>Can't display the PDF here. <a href="{{ pdf_file }}" target="_blank" rel="noopener">Open the PDF</a>.</p>
    </object>
  </div>
</div>

<script>
// Ensure modal wiring works on initial load and Hydejack SPA page loads
(function initPdfModal(){
  function wire(){
    var btn = document.getElementById('view-pdf-{{ pdf_id }}');
    var modal = document.getElementById('pdf-modal-{{ pdf_id }}');
    if (!btn || !modal) return;
    var closeBtn = modal.querySelector('.pdf-modal-close');
    if (!closeBtn) return;

    // Avoid multiple bindings
    if (!btn._pdfModalBound) {
      btn.addEventListener('click', function(){
        modal.classList.add('open');
        modal.setAttribute('aria-hidden', 'false');
      });
      btn._pdfModalBound = true;
    }

    if (!closeBtn._pdfModalBound) {
      closeBtn.addEventListener('click', function(){
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden', 'true');
      });
      closeBtn._pdfModalBound = true;
    }

    if (!modal._pdfBackdropBound) {
      modal.addEventListener('click', function(e){
        if (e.target === modal) {
          modal.classList.remove('open');
          modal.setAttribute('aria-hidden', 'true');
        }
      });
      modal._pdfBackdropBound = true;
    }
  }

  // Initial wiring
  wire();

  // Hydejack push-state wiring on dynamic loads
  var ps = document.getElementById('_pushState');
  if (ps) {
    ps.addEventListener('hy-push-state-after', function(){
      wire();
    });
  }
})();
</script>
